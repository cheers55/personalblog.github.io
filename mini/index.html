<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>🌈 走进小程序跨端框架原理 | 🌈 程晓辉</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="Personal Website">
    <link rel="preload" href="/assets/css/0.styles.dcfdf43b.css" as="style"><link rel="preload" href="/assets/js/app.08fa201f.js" as="script"><link rel="preload" href="/assets/js/2.6e992d99.js" as="script"><link rel="preload" href="/assets/js/7.b64a9f20.js" as="script"><link rel="prefetch" href="/assets/js/10.ac2055ab.js"><link rel="prefetch" href="/assets/js/11.1baa92da.js"><link rel="prefetch" href="/assets/js/12.7e3d5580.js"><link rel="prefetch" href="/assets/js/13.9685a5ae.js"><link rel="prefetch" href="/assets/js/14.f84062f4.js"><link rel="prefetch" href="/assets/js/15.f2bf3918.js"><link rel="prefetch" href="/assets/js/16.866be199.js"><link rel="prefetch" href="/assets/js/17.8008280e.js"><link rel="prefetch" href="/assets/js/18.8b17dff2.js"><link rel="prefetch" href="/assets/js/19.78eff8b5.js"><link rel="prefetch" href="/assets/js/20.ad91d0bc.js"><link rel="prefetch" href="/assets/js/21.281c5e1c.js"><link rel="prefetch" href="/assets/js/22.3a8f7ad1.js"><link rel="prefetch" href="/assets/js/23.4fefe559.js"><link rel="prefetch" href="/assets/js/24.1cfb2c54.js"><link rel="prefetch" href="/assets/js/25.4db0db1c.js"><link rel="prefetch" href="/assets/js/26.1ab74b99.js"><link rel="prefetch" href="/assets/js/27.85f86668.js"><link rel="prefetch" href="/assets/js/28.f6ea88a9.js"><link rel="prefetch" href="/assets/js/29.cc5245e6.js"><link rel="prefetch" href="/assets/js/3.c6b0e19d.js"><link rel="prefetch" href="/assets/js/30.574ee521.js"><link rel="prefetch" href="/assets/js/31.7c0d93bc.js"><link rel="prefetch" href="/assets/js/32.2d849805.js"><link rel="prefetch" href="/assets/js/33.799677b0.js"><link rel="prefetch" href="/assets/js/34.c5cbfe44.js"><link rel="prefetch" href="/assets/js/35.5bfe4c73.js"><link rel="prefetch" href="/assets/js/4.b7e6892f.js"><link rel="prefetch" href="/assets/js/5.e3920079.js"><link rel="prefetch" href="/assets/js/6.38a91462.js"><link rel="prefetch" href="/assets/js/8.e81bafa8.js"><link rel="prefetch" href="/assets/js/9.8fde4095.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dcfdf43b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">🌈 程晓辉</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/share/" class="nav-link">
  技术集
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/mini/" class="nav-link router-link-exact-active router-link-active">
  小程序
</a></div><div class="nav-item"><a href="/Aboutme/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/share/" class="nav-link">
  技术集
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/mini/" class="nav-link router-link-exact-active router-link-active">
  小程序
</a></div><div class="nav-item"><a href="/Aboutme/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>🌈 走进小程序跨端框架原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mini/#_1、小程序跨端框架分类" class="sidebar-link">1、小程序跨端框架分类</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mini/#_2、实现原理分类" class="sidebar-link">2、实现原理分类</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mini/#_3、vue-跨端框架" class="sidebar-link">3、Vue 跨端框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mini/#_3-1-style" class="sidebar-link">3.1 style</a></li><li class="sidebar-sub-header"><a href="/mini/#_3-2-template" class="sidebar-link">3.2 template</a></li><li class="sidebar-sub-header"><a href="/mini/#_3-3-script" class="sidebar-link">3.3 script</a></li><li class="sidebar-sub-header"><a href="/mini/#_3-4-vue-的核心流程" class="sidebar-link">3.4 Vue 的核心流程</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="🌈-走进小程序跨端框架原理"><a href="#🌈-走进小程序跨端框架原理" class="header-anchor">#</a> 🌈 走进小程序跨端框架原理</h1> <p>由于公司一些业务发展的需求，有使用 <code>mpvue</code> 开发过 <code>微信小程序 及 支付宝小程序</code>，感兴趣的小伙伴可以在 <code>微信、支付宝</code> 搜索 <code>享惠达人</code> 查看具体的小程序项目。之后还使用过 <code>Taro 、 微信原生api</code> 开发过 <code>拼团、商城等</code> 10 几个不同类型的小程序。如 <code>i麦当劳钱包余额、佳薪棠、光禹集团、开张吉祥大吉、熊猫商户六</code> 等。</p> <h2 id="_1、小程序跨端框架分类"><a href="#_1、小程序跨端框架分类" class="header-anchor">#</a> 1、小程序跨端框架分类</h2> <p>从框架的语法来说，可以分为两类：</p> <ol><li><strong>Vue 语法 / 类 Vue 语法</strong>；</li> <li><strong>React 语法 / 类 React 语法</strong>；</li></ol> <table><thead><tr><th style="text-align:left;">框架</th> <th style="text-align:left;">语法</th> <th style="text-align:left;">厂家</th></tr></thead> <tbody><tr><td style="text-align:left;">Taro 1/2</td> <td style="text-align:left;">类 React（nerve）</td> <td style="text-align:left;">京东</td></tr> <tr><td style="text-align:left;">Taro next</td> <td style="text-align:left;">React 或 Vue 或 Vue3 或 Nerv</td> <td style="text-align:left;">京东</td></tr> <tr><td style="text-align:left;">remax</td> <td style="text-align:left;">React</td> <td style="text-align:left;">蚂蚁金服</td></tr> <tr><td style="text-align:left;">mpvue</td> <td style="text-align:left;">Vue</td> <td style="text-align:left;">美团</td></tr> <tr><td style="text-align:left;">uni-app</td> <td style="text-align:left;">Vue</td> <td style="text-align:left;">Hbuilder</td></tr> <tr><td style="text-align:left;">megalo</td> <td style="text-align:left;">Vue</td> <td style="text-align:left;">网易考拉</td></tr> <tr><td style="text-align:left;">wepy</td> <td style="text-align:left;">类 Vue</td> <td style="text-align:left;">腾讯</td></tr> <tr><td style="text-align:left;">chameloen</td> <td style="text-align:left;">类 Vue</td> <td style="text-align:left;">滴滴</td></tr></tbody></table> <h2 id="_2、实现原理分类"><a href="#_2、实现原理分类" class="header-anchor">#</a> 2、实现原理分类</h2> <ol><li><strong>编译时（compile time）</strong>；</li> <li><strong>运行时（runtime）</strong>；</li></ol> <table><thead><tr><th style="text-align:left;">分类</th> <th style="text-align:left;">实现原理</th></tr></thead> <tbody><tr><td style="text-align:left;">compile time</td> <td style="text-align:left;">在编译打包过程中，利用 babel 工具通过 AST 进行转译，生成符合小程序规则的代码。</td></tr> <tr><td style="text-align:left;">runtime</td> <td style="text-align:left;">在小程序的逻辑层中运行起 <strong>React</strong> 或者 <strong>Vue</strong> 的运行时，通过适配层，实现自定义渲染器。</td></tr></tbody></table> <h2 id="_3、vue-跨端框架"><a href="#_3、vue-跨端框架" class="header-anchor">#</a> 3、Vue 跨端框架</h2> <p><code>.vue</code> 文件由 3 个部分组成：<code>template、script、style</code>。</p> <p>微信小程序 由 4 个部分组成：<code>wxml、wxss、js、json</code>。</p> <h3 id="_3-1-style"><a href="#_3-1-style" class="header-anchor">#</a> 3.1 style</h3> <p>在 <code>vue</code> 环境中的 <code>css样式</code>，大部分可以直接挪到 <code>.wxss</code>，除了少部分不支持的属性和小程序的单位转换。</p> <h3 id="_3-2-template"><a href="#_3-2-template" class="header-anchor">#</a> 3.2 template</h3> <p><code>vue</code> 中的很多标签也需要进行转化成对应的小程序语法。如：<code>div</code> 转化成 <code>view</code>。</p> <p><code>vue</code> 中的很多绑定事件也需要进行转化成对应的绑定事件。如：<code>@</code> 转化成 <code>bind</code>，<code>tap</code> 事件转化成 <code>click</code> 事件。</p> <p><code>vue</code> 中的很多模板语法也需要进行转化成对应的小程序模板语法。如：<code>v-if</code> 转化成 <code>wx:if</code>。</p> <p><code>template</code> 是采用了 <code>AST</code> 来解析转化模板。模板替换过程其实就是两侧对齐语法的过程，把语法不一致的地方改成一样的。</p> <h3 id="_3-3-script"><a href="#_3-3-script" class="header-anchor">#</a> 3.3 script</h3> <p><code>vue</code>中的代码是<strong>完全可以跑在小程序的逻辑层</strong>里面的，毕竟 <code>vue</code> 大部分其实就是纯粹的 <code>javascript</code>，也就是说，小程序的渲染层里面是完全可以直接运行起来 <code>vue</code> 的运行时和 <code>react</code> 的运行时的。但是小程序平台规定要在调用 <code>Page()</code> 方法生成一个 <code>page</code> 实例，否则页面就会报错。于是在 <code>vue</code> 实例化的时候，会调用 <code>init</code> 方法，在 <code>init</code> 方法里面会调用 <code>Page()</code> 函数，生成一个小程序的 <code>page</code> 实例。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>new Vue(){};
Vue.init = () =&gt; {
    // 在 vue 初始化的时候，调用了 page() 方法
    Page();
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>但是这样在一个小程序页面中，就会同时存在一个 <code>vue</code> 实例和一个小程序的 <code>page</code> 实例，他们又是怎么一起工作的呢？为了更方便理解，要讲一下 <code>vue</code> 的核心流程。</p> <h3 id="_3-4-vue-的核心流程"><a href="#_3-4-vue-的核心流程" class="header-anchor">#</a> 3.4 Vue 的核心流程</h3> <p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ce2f4c14ce048d79caa00539c203a87~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <p>如下图所示，<code>template</code> 模板部分会在编辑打包的过程中，被 <code>vue-loader</code> 调用 <code>compile</code> 方法通过词法分析生成一个 <code>ast</code> 对象，然后调用<strong>代码生成器</strong>，经过遍历 <code>AST</code> 树递归的拼接字符串操作，最终生成一段 <code>render</code> 函数，<code>render</code> 函数最后会存在打包生成的 <code>dist</code> 文件中。</p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f544fb5ed8b945bfac6f53a7ec2bd671~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <p>为了更方便理解，举个简单的例子：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;div class=&quot;demo&quot; @click=&quot;handleClick&quot;&gt;
  {{ text }}
&lt;/div&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>经过编译之后，通过 <code>ast</code> 进行分析，生成的 <code>render</code> 函数如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>_c(&quot;div&quot;, 
    { staticClass: &quot;demo&quot;, on: { click: _vm.handleClick } }，
    [_vm._t(&quot;default&quot;)]
)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong><code>render</code> 函数会在第一次 <code>mount</code> 时，或者 <code>vue</code> 维护的 <code>data</code> 有更新产生的时候会被执行。</strong></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.08fa201f.js" defer></script><script src="/assets/js/2.6e992d99.js" defer></script><script src="/assets/js/7.b64a9f20.js" defer></script>
  </body>
</html>
