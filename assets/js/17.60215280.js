(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{369:function(s,n,e){"use strict";e.r(n);var a=e(45),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"🌈-阅读-vue2-源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🌈-阅读-vue2-源码"}},[s._v("#")]),s._v(" 🌈 阅读 Vue2 源码")]),s._v(" "),e("h2",{attrs:{id:"_1-什么是-mvvm-数据双向绑定"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是-mvvm-数据双向绑定"}},[s._v("#")]),s._v(" 1. 什么是 MVVM 数据双向绑定")]),s._v(" "),e("ul",[e("li",[s._v("数据变化更新视图，视图变化更新数据。如图：")])]),s._v(" "),e("p",[e("img",{attrs:{src:"/vue_mvvm.png",alt:"mvvm数据双向绑定"}})]),s._v(" "),e("p",[e("code",[s._v("vue")]),s._v(" 为了实现数据的双向绑定，共分为"),e("code",[s._v("5")]),s._v("个步骤：")]),s._v(" "),e("ol",[e("li",[s._v("实现一个"),e("code",[s._v("监听器（Oserver）")]),s._v("，用来劫持并监听所有属性，如果属性发生变化，就通知订阅者；")]),s._v(" "),e("li",[s._v("实现一个"),e("code",[s._v("订阅器（Dep）")]),s._v("，用来收集订阅者，对"),e("code",[s._v("监听器（Oserver）")]),s._v("和"),e("code",[s._v("订阅器（Dep）")]),s._v("统一管理；")]),s._v(" "),e("li",[s._v("实现一个"),e("code",[s._v("订阅者（Watcher）")]),s._v("，可以收到属性的变化通知并执行相应的方法，从而更新视图；")]),s._v(" "),e("li",[s._v("实现一个"),e("code",[s._v("解析器（Compile）")]),s._v("，可以解析每个节点的相关指令，对模板数据和订阅器进行初始化；")]),s._v(" "),e("li",[s._v("实现一个"),e("code",[s._v("批量管理器（Batcher）")]),s._v("，可以批量处理多个订阅者来统一进行更新，防止页面卡顿；")])]),s._v(" "),e("p",[e("img",{attrs:{src:"/vue_reactive.jpg",alt:"vue_reactive"}})]),s._v(" "),e("ul",[e("li",[s._v("现在我们举一个"),e("code",[s._v("vue")]),s._v("实例，正式开始学习之路。")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('// vue实例\nconst vm = new Vue({\n    el: "#app",\n    data: {\n        text: "Hello World"\n    }\n});\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// MVVM.js\nfunction Vue(options){\n    // 从vue实例里把数据拿出来\n    this.data = options.data;\n    // 减少作用域链查找的过程\n    var data = this.data;\n    // 监听所有的数据\n    observer(data, this);\n    var id = options.el;\n    var el = ocument.querySelector(id);\n    // 编译dom\n    var dom = new Compile(el, this);\n    el.appendChild(dom);\n};\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h2",{attrs:{id:"_2-监听器-oserver-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-监听器-oserver-实现"}},[s._v("#")]),s._v(" 2. 监听器（Oserver）实现")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// Observer\nfunction Observer(data, vm){\n    // 为了监听所有属性，先要循环一下数据\n    Object.keys(data).forEach(function(key){\n        defineReactive(vm, key, data[key]);\n    });\n}\n\nfunction defineReactive(vm, key, val){\n    var dep = new Dep();\n    // 劫持所有属性，进行set和get\n    Object.defineProperty(vm, key, {\n        get: function(){\n            if(Dep.target){\n                // 收集依赖\n                dep.addSub(Dep.target);\n            }\n            return val;\n        },\n        set: function(newVal){\n            if(val === newVal) return;\n            val = newVal;\n            // 发出通知\n            dep.notify();\n        }\n    })\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("ul",[e("li",[s._v("通过以上代码我们不难看出，源码一上来对"),e("code",[s._v("data")]),s._v("进行了遍历并利用双向绑定的关键方法"),e("code",[s._v("Object.defineProperty")]),s._v("对数据进行读或者写，并利用"),e("code",[s._v("Dep（构造器）")]),s._v("进行收集依赖和发出通知。")])]),s._v(" "),e("blockquote",[e("p",[s._v("很多人面试的时候只能回答第一步，简单的说一下"),e("code",[s._v("Object.defineProperty")]),s._v("的用法，一带而过。这或许就是很多前端开始区分不同薪资、不同阶级的分水点。")])]),s._v(" "),e("p",[s._v("上边代码提到了"),e("code",[s._v("订阅器（Dep）")]),s._v("，那它到底是什么呢，上源码。")]),s._v(" "),e("h2",{attrs:{id:"_3-订阅器-dep-的实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-订阅器-dep-的实现"}},[s._v("#")]),s._v(" 3. 订阅器（Dep）的实现")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// Dep\nfunction Dep(){\n    this.subs = [];\n}\n\nDep.prototype = {\n    addSub: function(sub){\n        // 收集依赖\n        this.subs.push(sub);\n    },\n    notify: function(){\n        this.subs.forEach(function(sub){\n            // 所有依赖它的对象都会被通知\n            sub.update();\n        });\n    }\n};\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("ul",[e("li",[s._v("简单一看代码，是不是有一种很简单的感觉，简单的你想哭😂，但你还是看不懂，"),e("code",[s._v("Dep")]),s._v("到底是个啥，不着急，接下往下看。")])]),s._v(" "),e("h2",{attrs:{id:"_4-解析器-compile"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-解析器-compile"}},[s._v("#")]),s._v(" 4. 解析器（Compile）")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// Compile\nfunction Compile(node, vm){\n    if(node){\n        // 模仿虚拟dom\n        this.$frags = this.nodeToFragment(node, vm);\n        return this.$frags;\n    }\n}\n\nCompile.prototype = {\n    nodeToFragment(node, vm){\n        var _this = this;\n        var frag = docum,\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("blockquote",[e("p",[s._v("vue是不支持低版本浏览器的，比如ie6、7、8，但是如果想兼容怎么办，百度有自己的"),e("code",[s._v("san.js")]),s._v(" MVVM框架，原理是检测浏览器是否存在 "),e("code",[s._v("__defineGetter__")]),s._v(" 和 "),e("code",[s._v("__defineSetter__")]),s._v("，如果不存在，微软也有自己的 "),e("code",[s._v("VBScript")]),s._v("。")])])])}),[],!1,null,null,null);n.default=t.exports}}]);