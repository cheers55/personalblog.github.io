(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{329:function(t,e,v){"use strict";v.r(e);var _=v(33),a=Object(_.a)({},(function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"🌈-走进小程序跨端框架原理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#🌈-走进小程序跨端框架原理"}},[t._v("#")]),t._v(" 🌈 走进小程序跨端框架原理")]),t._v(" "),v("p",[t._v("由于公司一些业务发展的需求，有使用 "),v("code",[t._v("mpvue")]),t._v(" 开发过 "),v("code",[t._v("微信小程序 及 支付宝小程序")]),t._v("，感兴趣的小伙伴可以在 "),v("code",[t._v("微信、支付宝")]),t._v(" 搜索 "),v("code",[t._v("享惠达人")]),t._v(" 查看具体的小程序项目。之后还使用过 "),v("code",[t._v("Taro 、 微信原生api")]),t._v(" 开发过 "),v("code",[t._v("拼团、商城等")]),t._v(" 10 几个不同类型的小程序。如 "),v("code",[t._v("i麦当劳钱包余额、佳薪棠、光禹集团、开张吉祥大吉、熊猫商户六")]),t._v(" 等。")]),t._v(" "),v("h2",{attrs:{id:"_1、小程序跨端框架分类"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1、小程序跨端框架分类"}},[t._v("#")]),t._v(" 1、小程序跨端框架分类")]),t._v(" "),v("p",[t._v("从框架的语法来说，可以分为两类：")]),t._v(" "),v("ol",[v("li",[v("strong",[t._v("Vue 语法 / 类 Vue 语法")]),t._v("；")]),t._v(" "),v("li",[v("strong",[t._v("React 语法 / 类 React 语法")]),t._v("；")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",{staticStyle:{"text-align":"left"}},[t._v("框架")]),t._v(" "),v("th",{staticStyle:{"text-align":"left"}},[t._v("语法")]),t._v(" "),v("th",{staticStyle:{"text-align":"left"}},[t._v("厂家")])])]),t._v(" "),v("tbody",[v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Taro 1/2")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("类 React（nerve）")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("京东")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Taro next")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("React 或 Vue 或 Vue3 或 Nerv")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("京东")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("remax")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("React")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("蚂蚁金服")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("mpvue")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("Vue")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("美团")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("uni-app")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("Vue")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("Hbuilder")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("megalo")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("Vue")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("网易考拉")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("wepy")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("类 Vue")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("腾讯")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("chameloen")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("类 Vue")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("滴滴")])])])]),t._v(" "),v("h2",{attrs:{id:"_2、实现原理分类"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2、实现原理分类"}},[t._v("#")]),t._v(" 2、实现原理分类")]),t._v(" "),v("ol",[v("li",[v("strong",[t._v("编译时（compile time）")]),t._v("；")]),t._v(" "),v("li",[v("strong",[t._v("运行时（runtime）")]),t._v("；")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",{staticStyle:{"text-align":"left"}},[t._v("分类")]),t._v(" "),v("th",{staticStyle:{"text-align":"left"}},[t._v("实现原理")])])]),t._v(" "),v("tbody",[v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("compile time")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("在编译打包过程中，利用 babel 工具通过 AST 进行转译，生成符合小程序规则的代码。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("runtime")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("在小程序的逻辑层中运行起 "),v("strong",[t._v("React")]),t._v(" 或者 "),v("strong",[t._v("Vue")]),t._v(" 的运行时，通过适配层，实现自定义渲染器。")])])])]),t._v(" "),v("h2",{attrs:{id:"_3、vue-跨端框架"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3、vue-跨端框架"}},[t._v("#")]),t._v(" 3、Vue 跨端框架")]),t._v(" "),v("p",[v("code",[t._v(".vue")]),t._v(" 文件由 3 个部分组成："),v("code",[t._v("template、script、style")]),t._v("。")]),t._v(" "),v("p",[t._v("微信小程序 由 4 个部分组成："),v("code",[t._v("wxml、wxss、js、json")]),t._v("。")]),t._v(" "),v("h3",{attrs:{id:"_3-1-style"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-style"}},[t._v("#")]),t._v(" 3.1 style")]),t._v(" "),v("p",[t._v("在 "),v("code",[t._v("vue")]),t._v(" 环境中的 "),v("code",[t._v("css样式")]),t._v("，大部分可以直接挪到 "),v("code",[t._v(".wxss")]),t._v("，除了少部分不支持的属性和小程序的单位转换。")]),t._v(" "),v("h3",{attrs:{id:"_3-2-template"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-template"}},[t._v("#")]),t._v(" 3.2 template")]),t._v(" "),v("p",[v("code",[t._v("vue")]),t._v(" 中的很多标签也需要进行转化成对应的小程序语法。如："),v("code",[t._v("div")]),t._v(" 转化成 "),v("code",[t._v("view")]),t._v("。")]),t._v(" "),v("p",[v("code",[t._v("vue")]),t._v(" 中的很多绑定事件也需要进行转化成对应的绑定事件。如："),v("code",[t._v("@")]),t._v(" 转化成 "),v("code",[t._v("bind")]),t._v("，"),v("code",[t._v("tap")]),t._v(" 事件转化成 "),v("code",[t._v("click")]),t._v(" 事件。")]),t._v(" "),v("p",[v("code",[t._v("vue")]),t._v(" 中的很多模板语法也需要进行转化成对应的小程序模板语法。如："),v("code",[t._v("v-if")]),t._v(" 转化成 "),v("code",[t._v("wx:if")]),t._v("。")]),t._v(" "),v("p",[v("code",[t._v("template")]),t._v(" 是采用了 "),v("code",[t._v("AST")]),t._v(" 来解析转化模板。模板替换过程其实就是两侧对齐语法的过程，把语法不一致的地方改成一样的。")]),t._v(" "),v("h3",{attrs:{id:"_3-3-script"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-script"}},[t._v("#")]),t._v(" 3.3 script")]),t._v(" "),v("p",[v("code",[t._v("vue")]),t._v("中的代码是"),v("strong",[t._v("完全可以跑在小程序的逻辑层")]),t._v("里面的，毕竟 "),v("code",[t._v("vue")]),t._v(" 大部分其实就是纯粹的 "),v("code",[t._v("javascript")]),t._v("，也就是说，小程序的渲染层里面是完全可以直接运行起来 "),v("code",[t._v("vue")]),t._v(" 的运行时和 "),v("code",[t._v("react")]),t._v(" 的运行时的。但是小程序平台规定要在调用 "),v("code",[t._v("Page()")]),t._v(" 方法生成一个 "),v("code",[t._v("page")]),t._v(" 实例，否则页面就会报错。于是在 "),v("code",[t._v("vue")]),t._v(" 实例化的时候，会调用 "),v("code",[t._v("init")]),t._v(" 方法，在 "),v("code",[t._v("init")]),t._v(" 方法里面会调用 "),v("code",[t._v("Page()")]),t._v(" 函数，生成一个小程序的 "),v("code",[t._v("page")]),t._v(" 实例。")]),t._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("new Vue(){};\nVue.init = () => {\n    // 在 vue 初始化的时候，调用了 page() 方法\n    Page();\n}\n")])]),t._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[t._v("1")]),v("br"),v("span",{staticClass:"line-number"},[t._v("2")]),v("br"),v("span",{staticClass:"line-number"},[t._v("3")]),v("br"),v("span",{staticClass:"line-number"},[t._v("4")]),v("br"),v("span",{staticClass:"line-number"},[t._v("5")]),v("br")])]),v("p",[t._v("但是这样在一个小程序页面中，就会同时存在一个 "),v("code",[t._v("vue")]),t._v(" 实例和一个小程序的 "),v("code",[t._v("page")]),t._v(" 实例，他们又是怎么一起工作的呢？为了更方便理解，要讲一下 "),v("code",[t._v("vue")]),t._v(" 的核心流程。")]),t._v(" "),v("h3",{attrs:{id:"_3-4-vue-的核心流程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-vue-的核心流程"}},[t._v("#")]),t._v(" 3.4 Vue 的核心流程")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ce2f4c14ce048d79caa00539c203a87~tplv-k3u1fbpfcp-watermark.image",alt:""}})]),t._v(" "),v("p",[t._v("如下图所示，"),v("code",[t._v("template")]),t._v(" 模板部分会在编辑打包的过程中，被 "),v("code",[t._v("vue-loader")]),t._v(" 调用 "),v("code",[t._v("compile")]),t._v(" 方法通过词法分析生成一个 "),v("code",[t._v("ast")]),t._v(" 对象，然后调用"),v("strong",[t._v("代码生成器")]),t._v("，经过遍历 "),v("code",[t._v("AST")]),t._v(" 树递归的拼接字符串操作，最终生成一段 "),v("code",[t._v("render")]),t._v(" 函数，"),v("code",[t._v("render")]),t._v(" 函数最后会存在打包生成的 "),v("code",[t._v("dist")]),t._v(" 文件中。")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f544fb5ed8b945bfac6f53a7ec2bd671~tplv-k3u1fbpfcp-watermark.image",alt:""}})]),t._v(" "),v("p",[t._v("为了更方便理解，举个简单的例子：")]),t._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v('<div class="demo" @click="handleClick">\n  {{ text }}\n</div>\n')])]),t._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[t._v("1")]),v("br"),v("span",{staticClass:"line-number"},[t._v("2")]),v("br"),v("span",{staticClass:"line-number"},[t._v("3")]),v("br")])]),v("p",[t._v("经过编译之后，通过 "),v("code",[t._v("ast")]),t._v(" 进行分析，生成的 "),v("code",[t._v("render")]),t._v(" 函数如下：")]),t._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v('_c("div", \n    { staticClass: "demo", on: { click: _vm.handleClick } }，\n    [_vm._t("default")]\n)\n')])]),t._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[t._v("1")]),v("br"),v("span",{staticClass:"line-number"},[t._v("2")]),v("br"),v("span",{staticClass:"line-number"},[t._v("3")]),v("br"),v("span",{staticClass:"line-number"},[t._v("4")]),v("br")])]),v("p",[v("strong",[v("code",[t._v("render")]),t._v(" 函数会在第一次 "),v("code",[t._v("mount")]),t._v(" 时，或者 "),v("code",[t._v("vue")]),t._v(" 维护的 "),v("code",[t._v("data")]),t._v(" 有更新产生的时候会被执行。")])])])}),[],!1,null,null,null);e.default=a.exports}}]);