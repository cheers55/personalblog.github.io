(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{330:function(t,_,v){"use strict";v.r(_);var a=v(33),e=Object(a.a)({},(function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"🌈-浏览器的缓存机制"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#🌈-浏览器的缓存机制"}},[t._v("#")]),t._v(" 🌈 浏览器的缓存机制")]),t._v(" "),v("h2",{attrs:{id:"_1-概述"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-概述"}},[t._v("#")]),t._v(" 1. 概述")]),t._v(" "),v("p",[t._v("就是我们所说的"),v("code",[t._v("Http")]),t._v("缓存机制，其机制是根据"),v("code",[t._v("Http")]),t._v("报文的缓存标识进行的，所以在分析浏览器缓存机制之前，我们先使用图文简单介绍一下"),v("code",[t._v("Http报文")]),t._v("。")]),t._v(" "),v("blockquote",[v("p",[t._v("这里会衍生出其中一个知识点，"),v("a",{attrs:{href:"http_message"}},[t._v("Http报文")])])]),t._v(" "),v("h2",{attrs:{id:"_2-http缓存过程分为强制缓存、协商缓存两部分"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-http缓存过程分为强制缓存、协商缓存两部分"}},[t._v("#")]),t._v(" 2. Http缓存过程分为强制缓存、协商缓存两部分")]),t._v(" "),v("h3",{attrs:{id:"_2-1-强制缓存"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-强制缓存"}},[t._v("#")]),t._v(" 2.1 强制缓存")]),t._v(" "),v("p",[v("strong",[t._v("强制缓存就是向浏览器缓存查找该请求结果，并根据该结果的缓存规则来决定是否使用该缓存结果的过程")]),t._v("，强制缓存的情况主要有三种：")]),t._v(" "),v("ol",[v("li",[t._v("不存在该缓存结果和缓存标识，强制缓存失效，则直接向服务器发起请求")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30ThRw5TMP5GXcIzFUhJCiYVG-.png",alt:""}})]),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[t._v("存在该缓存结果和缓存标识，但是结果已经失效，强制缓存失效，则使用协商缓存")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30Bd_Ct_JmCV4IGWgVwrwonHCh.png",alt:""}})]),t._v(" "),v("ol",{attrs:{start:"3"}},[v("li",[t._v("存在该缓存结果和缓存标识，且该结果没有还没有失效，强制缓存生效，直接返回该结果")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30WBGAfz4BMLy-ZaljsVGF0Z9z.png",alt:""}})]),t._v(" "),v("p",[t._v("总结：当浏览器向服务器发送请求的时候，服务器会将缓存规则放入HTTP响应的报文的HTTP头中和请求结果一起返回给浏览器，控制强制缓存的字段分别是"),v("code",[t._v("Expires")]),t._v("和"),v("code",[t._v("Cache-Control")]),t._v("，"),v("strong",[t._v("其中"),v("code",[t._v("Cache-Conctrol")]),t._v("的优先级比"),v("code",[t._v("Expires")]),t._v("高")]),t._v("。")]),t._v(" "),v("h4",{attrs:{id:"_2-1-1-过期时间（expires）"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-过期时间（expires）"}},[t._v("#")]),t._v(" 2.1.1 过期时间（Expires）")]),t._v(" "),v("p",[v("code",[t._v("Expires")]),t._v("是"),v("code",[t._v("HTTP/1.0")]),t._v("控制网页缓存的字段，其值为服务器返回该请求结果缓存的到期时间，即再次发送请求时，如果客户端的时间小于"),v("code",[t._v("Expires")]),t._v("的值时，直接使用缓存结果。")]),t._v(" "),v("p",[t._v("到了"),v("code",[t._v("HTTP/1.1")]),t._v("，"),v("code",[t._v("Expires")]),t._v("已经被"),v("code",[t._v("Cache-Control")]),t._v("替代，原因在于"),v("code",[t._v("Expires")]),t._v("控制缓存的原理是使用客户端的时间与服务端返回的时间做对比，如果客户端与服务端的时间由于某些原因（时区不同；客户端和服务端有一方的时间不准确）发生误差，那么强制缓存直接失效，则强制缓存存在的意义就毫无意义了。")]),t._v(" "),v("h4",{attrs:{id:"_2-1-2-过期时间（cache-control）"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-过期时间（cache-control）"}},[t._v("#")]),t._v(" 2.1.2 过期时间（Cache-Control）")]),t._v(" "),v("p",[t._v("在"),v("code",[t._v("HTTP/1.1")]),t._v("中，"),v("code",[t._v("Cache-Control")]),t._v("是最重要的规则，主要用于控制网页缓存，主要取值为：")]),t._v(" "),v("ol",[v("li",[v("strong",[t._v("private（默认值）")]),t._v("：所有内容只有客户端可以缓存；")]),t._v(" "),v("li",[v("strong",[t._v("public")]),t._v("：所有内容都将被缓存（客户端和代理服务器都可缓存）；")]),t._v(" "),v("li",[v("strong",[t._v("no-cache")]),t._v("：客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定；")]),t._v(" "),v("li",[v("strong",[t._v("no-store")]),t._v("：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存；")]),t._v(" "),v("li",[v("strong",[t._v("max-age")]),t._v("：缓存内容将在xxx秒后失效；")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30sQ8AGKjjQJY8Iqs6HsrOdc8-.png",alt:""}})]),t._v(" "),v("p",[t._v("由上图内容我们可以知道：")]),t._v(" "),v("p",[t._v("由于"),v("code",[t._v("Cache-Control")]),t._v("的优先级比"),v("code",[t._v("Expires")]),t._v("高，那么直接根据"),v("code",[t._v("Cache-Control")]),t._v("的值进行缓存，意思就是说在600秒内再次发起该请求，则会直接使用缓存结果，强制缓存生效。")]),t._v(" "),v("ul",[v("li",[t._v("在无法确定客户端的时间是否与服务端的时间同步的情况下，"),v("code",[t._v("Cache-Control")]),t._v("相比于"),v("code",[t._v("Expires")]),t._v("是更好的选择，如果同时存在时，"),v("code",[t._v("只有Cache-Control")]),t._v("生效。")])]),t._v(" "),v("blockquote",[v("p",[t._v("这里拓展一些其他额外的知识点：内存缓存和硬盘缓存。")]),t._v(" "),v("blockquote",[v("p",[t._v("内存缓存具有快速读取（编译解析后的部分文件直接进入该进程的内存中，以便下次运行使用时快速读取）、时效性（一旦进程关闭，该进程的内存就会清空）。")]),t._v(" "),v("blockquote",[v("p",[t._v("硬盘缓存则是直接将缓存写入硬盘文件中，读取缓存需要对该缓存存放在硬盘文件进行I/O操作，然后重新解析该缓存内容，读取复杂，速度比内存慢。")]),t._v(" "),v("blockquote",[v("p",[t._v("在浏览器中，js、图片等一般直接存在内存中，css文件则会存入硬盘文件中。")])])])])]),t._v(" "),v("h3",{attrs:{id:"_2-2-协商缓存"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-协商缓存"}},[t._v("#")]),t._v(" 2.2 协商缓存")]),t._v(" "),v("p",[t._v("协商缓存就是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程")]),t._v(" "),v("ol",[v("li",[t._v("协商缓存生效，返回304")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30OK3o7ZD3zsTVJVE0qwrTs_97.png",alt:""}})]),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[t._v("协商缓存失败，返回200和请求结果")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30iC1c-X0hWv-XnBhG0MyFpesx.png",alt:""}})]),t._v(" "),v("p",[t._v("同样，协商缓存的标识也是在响应报文的HTTP头中和请求结果一起返回给浏览器的，控制协商缓存的字段分别有："),v("code",[t._v("Last-Modified、If-Modified-Since")]),t._v("和"),v("code",[t._v("Etag、If-None-Match")]),t._v("，其中"),v("code",[t._v("Etag、If-None-Match")]),t._v("的优先级比"),v("code",[t._v("Last-Modified、If-Modified-Since")]),t._v("高。")]),t._v(" "),v("h4",{attrs:{id:"_2-2-1-last-modified-和-if-modified-since"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-last-modified-和-if-modified-since"}},[t._v("#")]),t._v(" 2.2.1 Last-Modified 和 If-Modified-Since")]),t._v(" "),v("ol",[v("li",[v("code",[t._v("Last-Modified")]),t._v("是服务器响应请求时，返回该资源文件在服务器最后被修改的时间")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30LUFHzlQVhb4k3px9xOwMLCdg.png",alt:""}})]),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[v("code",[t._v("If-Modified-Since")]),t._v("则是客户端再次发起该请求时，携带上次请求返回的"),v("code",[t._v("Last-Modified")]),t._v("值，通过此字段值告诉服务器该资源上次请求返回的最后被修改时间。服务器收到该请求，发现请求头含有"),v("code",[t._v("If-Modified-Since")]),t._v("字段，则会根据"),v("code",[t._v("If-Modified-Since")]),t._v("的字段值与该资源在服务器的最后被修改时间做对比，若服务器的资源最后被修改时间大于"),v("code",[t._v("If-Modified-Since")]),t._v("的字段值，则重新返回资源，状态码为"),v("code",[t._v("200")]),t._v("；否则则返回"),v("code",[t._v("304")]),t._v("，代表资源无更新，可继续使用缓存文件。")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30iQQok5pF5Nw6JbJ691bLckqf.png",alt:""}})]),t._v(" "),v("h4",{attrs:{id:"_2-2-2-etag-和-if-none-match"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-etag-和-if-none-match"}},[t._v("#")]),t._v(" 2.2.2 Etag 和 If-None-Match")]),t._v(" "),v("ol",[v("li",[v("code",[t._v("Etag")]),t._v("是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30VcTixbjlVzDUcPoKjM30OkCD.png",alt:""}})]),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[v("code",[t._v("If-None-Match")]),t._v("是客户端再次发起该请求时，携带上次请求返回的唯一标识"),v("code",[t._v("Etag")]),t._v("值，通过此字段值告诉服务器该资源上次请求返回的唯一标识值。服务器收到该请求后，发现该请求头中含有"),v("code",[t._v("If-None-Match")]),t._v("，则会根据"),v("code",[t._v("If-None-Match")]),t._v("的字段值与该资源在服务器的"),v("code",[t._v("Etag")]),t._v("值做对比，一致则返回"),v("code",[t._v("304")]),t._v("，代表资源无更新，继续使用缓存文件；不一致则重新返回资源文件，状态码为"),v("code",[t._v("200")]),t._v("。")])]),t._v(" "),v("ul",[v("li",[v("code",[t._v("Etag、If-None-Match")]),t._v("优先级高于"),v("code",[t._v("Last-Modified、If-Modified-Since")]),t._v("，同时存在则只有"),v("code",[t._v("Etag、If-None-Match")]),t._v("生效。")])]),t._v(" "),v("h2",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),v("p",[t._v("强制缓存优先于协商缓存进行，若强制缓存(Expires和Cache-Control)生效则直接使用缓存，若不生效则进行协商缓存(Last-Modified / If-Modified-Since和Etag / If-None-Match)，协商缓存由服务器决定是否使用缓存，若协商缓存失效，那么代表该请求的缓存失效，重新获取请求结果，再存入浏览器缓存中；生效则返回304，继续使用缓存，主要过程如下：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30SX0D2hqApuJ7Z44y609Z3RKp.png",alt:""}})]),t._v(" "),v("ul",[v("li",[t._v("以上部分资料参考"),v("a",{attrs:{href:"https://blog.csdn.net/saucxs/article/details/87625767",target:"_blank",rel:"noopener noreferrer"}},[t._v("彻底理解浏览器的缓存机制（http缓存机制）"),v("OutboundLink")],1)])])])}),[],!1,null,null,null);_.default=e.exports}}]);