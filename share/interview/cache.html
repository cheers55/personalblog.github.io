<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>🌈 浏览器的缓存机制 | 🌈 程晓辉</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Personal Website">
    
    <link rel="preload" href="/assets/css/0.styles.f175d11a.css" as="style"><link rel="preload" href="/assets/js/app.068a4f65.js" as="script"><link rel="preload" href="/assets/js/2.05078575.js" as="script"><link rel="preload" href="/assets/js/31.8182fad1.js" as="script"><link rel="prefetch" href="/assets/js/10.c4fe3017.js"><link rel="prefetch" href="/assets/js/11.65037793.js"><link rel="prefetch" href="/assets/js/12.682fc023.js"><link rel="prefetch" href="/assets/js/13.db347a96.js"><link rel="prefetch" href="/assets/js/14.5a72dead.js"><link rel="prefetch" href="/assets/js/15.002997dd.js"><link rel="prefetch" href="/assets/js/16.66f578cb.js"><link rel="prefetch" href="/assets/js/17.87f74e49.js"><link rel="prefetch" href="/assets/js/18.859d3b68.js"><link rel="prefetch" href="/assets/js/19.decaaf0e.js"><link rel="prefetch" href="/assets/js/20.49797c96.js"><link rel="prefetch" href="/assets/js/21.2189bf11.js"><link rel="prefetch" href="/assets/js/22.7567fad1.js"><link rel="prefetch" href="/assets/js/23.03bffcec.js"><link rel="prefetch" href="/assets/js/24.6ecb55a4.js"><link rel="prefetch" href="/assets/js/25.847e675e.js"><link rel="prefetch" href="/assets/js/26.dfc963a1.js"><link rel="prefetch" href="/assets/js/27.e850d9ac.js"><link rel="prefetch" href="/assets/js/28.6d0263fc.js"><link rel="prefetch" href="/assets/js/29.bd467d42.js"><link rel="prefetch" href="/assets/js/3.bbe5046a.js"><link rel="prefetch" href="/assets/js/30.12d0af71.js"><link rel="prefetch" href="/assets/js/32.6ee19553.js"><link rel="prefetch" href="/assets/js/33.97c6a2a1.js"><link rel="prefetch" href="/assets/js/34.d163b248.js"><link rel="prefetch" href="/assets/js/35.24e0e9b7.js"><link rel="prefetch" href="/assets/js/36.227bccf9.js"><link rel="prefetch" href="/assets/js/37.7e752b83.js"><link rel="prefetch" href="/assets/js/38.63c33a72.js"><link rel="prefetch" href="/assets/js/39.c447da1a.js"><link rel="prefetch" href="/assets/js/4.d2be4349.js"><link rel="prefetch" href="/assets/js/40.fdafddc3.js"><link rel="prefetch" href="/assets/js/41.7b4ac0b7.js"><link rel="prefetch" href="/assets/js/42.8b335077.js"><link rel="prefetch" href="/assets/js/43.004ba8d0.js"><link rel="prefetch" href="/assets/js/44.4ed22e86.js"><link rel="prefetch" href="/assets/js/45.aefec7bf.js"><link rel="prefetch" href="/assets/js/46.41c29fbf.js"><link rel="prefetch" href="/assets/js/47.2c42172b.js"><link rel="prefetch" href="/assets/js/48.d254146c.js"><link rel="prefetch" href="/assets/js/5.e62e8fba.js"><link rel="prefetch" href="/assets/js/6.4a0603f6.js"><link rel="prefetch" href="/assets/js/7.60e05ba3.js"><link rel="prefetch" href="/assets/js/8.f9b46b6e.js"><link rel="prefetch" href="/assets/js/9.0cf5007c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f175d11a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">🌈 程晓辉</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/share/" class="nav-link router-link-active">
  技术集
</a></div><div class="nav-item"><a href="/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/frame/" class="nav-link">
  框架
</a></div><div class="nav-item"><a href="/panClient/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/aboutMe/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/share/" class="nav-link router-link-active">
  技术集
</a></div><div class="nav-item"><a href="/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/frame/" class="nav-link">
  框架
</a></div><div class="nav-item"><a href="/panClient/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/aboutMe/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>🌈 浏览器的缓存机制</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/share/interview/cache.html#_1-概述" class="sidebar-link">1. 概述</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/share/interview/cache.html#_2-http缓存过程分为强制缓存、协商缓存两部分" class="sidebar-link">2. Http缓存过程分为强制缓存、协商缓存两部分</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/share/interview/cache.html#_2-1-强制缓存" class="sidebar-link">2.1 强制缓存</a></li><li class="sidebar-sub-header"><a href="/share/interview/cache.html#_2-2-协商缓存" class="sidebar-link">2.2 协商缓存</a></li></ul></li><li><a href="/share/interview/cache.html#总结" class="sidebar-link">总结</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="🌈-浏览器的缓存机制"><a href="#🌈-浏览器的缓存机制" class="header-anchor">#</a> 🌈 浏览器的缓存机制</h1> <h2 id="_1-概述"><a href="#_1-概述" class="header-anchor">#</a> 1. 概述</h2> <p>就是我们所说的<code>Http</code>缓存机制，其机制是根据<code>Http</code>报文的缓存标识进行的，所以在分析浏览器缓存机制之前，我们先使用图文简单介绍一下<code>Http报文</code>。</p> <blockquote><p>这里会衍生出其中一个知识点，<a href="http_message">Http报文</a></p></blockquote> <h2 id="_2-http缓存过程分为强制缓存、协商缓存两部分"><a href="#_2-http缓存过程分为强制缓存、协商缓存两部分" class="header-anchor">#</a> 2. Http缓存过程分为强制缓存、协商缓存两部分</h2> <h3 id="_2-1-强制缓存"><a href="#_2-1-强制缓存" class="header-anchor">#</a> 2.1 强制缓存</h3> <p><strong>强制缓存就是向浏览器缓存查找该请求结果，并根据该结果的缓存规则来决定是否使用该缓存结果的过程</strong>，强制缓存的情况主要有三种：</p> <ol><li>不存在该缓存结果和缓存标识，强制缓存失效，则直接向服务器发起请求</li></ol> <p><img src="https://www.mwcxs.top/static/upload/pics/2019/1/30ThRw5TMP5GXcIzFUhJCiYVG-.png" alt=""></p> <ol start="2"><li>存在该缓存结果和缓存标识，但是结果已经失效，强制缓存失效，则使用协商缓存</li></ol> <p><img src="https://www.mwcxs.top/static/upload/pics/2019/1/30Bd_Ct_JmCV4IGWgVwrwonHCh.png" alt=""></p> <ol start="3"><li>存在该缓存结果和缓存标识，且该结果没有还没有失效，强制缓存生效，直接返回该结果</li></ol> <p><img src="https://www.mwcxs.top/static/upload/pics/2019/1/30WBGAfz4BMLy-ZaljsVGF0Z9z.png" alt=""></p> <p>总结：当浏览器向服务器发送请求的时候，服务器会将缓存规则放入HTTP响应的报文的HTTP头中和请求结果一起返回给浏览器，控制强制缓存的字段分别是<code>Expires</code>和<code>Cache-Control</code>，<strong>其中<code>Cache-Conctrol</code>的优先级比<code>Expires</code>高</strong>。</p> <h4 id="_2-1-1-过期时间-expires"><a href="#_2-1-1-过期时间-expires" class="header-anchor">#</a> 2.1.1 过期时间（Expires）</h4> <p><code>Expires</code>是<code>HTTP/1.0</code>控制网页缓存的字段，其值为服务器返回该请求结果缓存的到期时间，即再次发送请求时，如果客户端的时间小于<code>Expires</code>的值时，直接使用缓存结果。</p> <p>到了<code>HTTP/1.1</code>，<code>Expires</code>已经被<code>Cache-Control</code>替代，原因在于<code>Expires</code>控制缓存的原理是使用客户端的时间与服务端返回的时间做对比，如果客户端与服务端的时间由于某些原因（时区不同；客户端和服务端有一方的时间不准确）发生误差，那么强制缓存直接失效，则强制缓存存在就毫无意义了。</p> <h4 id="_2-1-2-过期时间-cache-control"><a href="#_2-1-2-过期时间-cache-control" class="header-anchor">#</a> 2.1.2 过期时间（Cache-Control）</h4> <p>在<code>HTTP/1.1</code>中，<code>Cache-Control</code>是最重要的规则，主要用于控制网页缓存，主要取值为：</p> <ol><li><strong>private（默认值）</strong>：所有内容只有客户端可以缓存；</li> <li><strong>public</strong>：所有内容都将被缓存（客户端和代理服务器都可缓存）；</li> <li><strong>no-cache</strong>：客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定；</li> <li><strong>no-store</strong>：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存；</li> <li><strong>max-age</strong>：缓存内容将在xxx秒后失效；</li></ol> <p><img src="https://www.mwcxs.top/static/upload/pics/2019/1/30sQ8AGKjjQJY8Iqs6HsrOdc8-.png" alt=""></p> <p>由上图内容我们可以知道：</p> <p>由于<code>Cache-Control</code>的优先级比<code>Expires</code>高，那么直接根据<code>Cache-Control</code>的值进行缓存，意思就是说在600秒内再次发起该请求，则会直接使用缓存结果，强制缓存生效。</p> <ul><li>在无法确定客户端的时间是否与服务端的时间同步的情况下，<code>Cache-Control</code>相比于<code>Expires</code>是更好的选择，如果同时存在时，<code>只有Cache-Control</code>生效。</li></ul> <blockquote><p>这里拓展一些其他额外的知识点：内存缓存和硬盘缓存。</p> <blockquote><p>内存缓存具有快速读取（编译解析后的部分文件直接进入该进程的内存中，以便下次运行使用时快速读取）、时效性（一旦进程关闭，该进程的内存就会清空）。</p> <blockquote><p>硬盘缓存则是直接将缓存写入硬盘文件中，读取缓存需要对该缓存存放在硬盘文件进行I/O操作，然后重新解析该缓存内容，读取复杂，速度比内存慢。</p> <blockquote><p>在浏览器中，js、图片等一般直接存在内存中，css文件则会存入硬盘文件中。</p></blockquote></blockquote></blockquote></blockquote> <h3 id="_2-2-协商缓存"><a href="#_2-2-协商缓存" class="header-anchor">#</a> 2.2 协商缓存</h3> <p>协商缓存就是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程</p> <ol><li>协商缓存生效，返回304</li></ol> <p><img src="https://www.mwcxs.top/static/upload/pics/2019/1/30OK3o7ZD3zsTVJVE0qwrTs_97.png" alt=""></p> <ol start="2"><li>协商缓存失败，返回200和请求结果</li></ol> <p><img src="https://www.mwcxs.top/static/upload/pics/2019/1/30iC1c-X0hWv-XnBhG0MyFpesx.png" alt=""></p> <p>同样，协商缓存的标识也是在响应报文的HTTP头中和请求结果一起返回给浏览器的，控制协商缓存的字段分别有：<code>Last-Modified、If-Modified-Since</code>和<code>Etag、If-None-Match</code>，其中<code>Etag、If-None-Match</code>的优先级比<code>Last-Modified、If-Modified-Since</code>高。</p> <h4 id="_2-2-1-last-modified-和-if-modified-since"><a href="#_2-2-1-last-modified-和-if-modified-since" class="header-anchor">#</a> 2.2.1 Last-Modified 和 If-Modified-Since</h4> <ol><li><code>Last-Modified</code>是服务器响应请求时，返回该资源文件在服务器最后被修改的时间</li></ol> <p><img src="https://www.mwcxs.top/static/upload/pics/2019/1/30LUFHzlQVhb4k3px9xOwMLCdg.png" alt=""></p> <ol start="2"><li><code>If-Modified-Since</code>则是客户端再次发起该请求时，携带上次请求返回的<code>Last-Modified</code>值，通过此字段值告诉服务器该资源上次请求返回的最后被修改时间。服务器收到该请求，发现请求头含有<code>If-Modified-Since</code>字段，则会根据<code>If-Modified-Since</code>的字段值与该资源在服务器的最后被修改时间做对比，若服务器的资源最后被修改时间大于<code>If-Modified-Since</code>的字段值，则重新返回资源，状态码为<code>200</code>；否则则返回<code>304</code>，代表资源无更新，可继续使用缓存文件。</li></ol> <p><img src="https://www.mwcxs.top/static/upload/pics/2019/1/30iQQok5pF5Nw6JbJ691bLckqf.png" alt=""></p> <h4 id="_2-2-2-etag-和-if-none-match"><a href="#_2-2-2-etag-和-if-none-match" class="header-anchor">#</a> 2.2.2 Etag 和 If-None-Match</h4> <ol><li><code>Etag</code>是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)</li></ol> <p><img src="https://www.mwcxs.top/static/upload/pics/2019/1/30VcTixbjlVzDUcPoKjM30OkCD.png" alt=""></p> <ol start="2"><li><code>If-None-Match</code>是客户端再次发起该请求时，携带上次请求返回的唯一标识<code>Etag</code>值，通过此字段值告诉服务器该资源上次请求返回的唯一标识值。服务器收到该请求后，发现该请求头中含有<code>If-None-Match</code>，则会根据<code>If-None-Match</code>的字段值与该资源在服务器的<code>Etag</code>值做对比，一致则返回<code>304</code>，代表资源无更新，继续使用缓存文件；不一致则重新返回资源文件，状态码为<code>200</code>。</li></ol> <ul><li><code>Etag、If-None-Match</code>优先级高于<code>Last-Modified、If-Modified-Since</code>，同时存在则只有<code>Etag、If-None-Match</code>生效。</li></ul> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>强制缓存优先于协商缓存进行，若强制缓存(Expires和Cache-Control)生效则直接使用缓存，若不生效则进行协商缓存(Last-Modified / If-Modified-Since和Etag / If-None-Match)，协商缓存由服务器决定是否使用缓存，若协商缓存失效，那么代表该请求的缓存失效，重新获取请求结果，再存入浏览器缓存中；生效则返回304，继续使用缓存，主要过程如下：</p> <p><img src="https://www.mwcxs.top/static/upload/pics/2019/1/30SX0D2hqApuJ7Z44y609Z3RKp.png" alt=""></p> <ul><li>以上部分资料参考<a href="https://blog.csdn.net/saucxs/article/details/87625767" target="_blank" rel="noopener noreferrer">彻底理解浏览器的缓存机制（http缓存机制）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.068a4f65.js" defer></script><script src="/assets/js/2.05078575.js" defer></script><script src="/assets/js/31.8182fad1.js" defer></script>
  </body>
</html>
